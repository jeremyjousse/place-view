name: Deploy
on:
    push:
        branches:
            - main
        # paths:
        #     - "webapp/src/**"
        #     - "webapp/static/**"
        #     - "webapp/package.json"
        #     - "webapp/pnpm-lock.yaml"

jobs:
    deploy:
        runs-on: ubuntu-latest
        permissions:
            id-token: write
            contents: read
        steps:
            - name: Checkout repo
              uses: actions/checkout@v4
            - name: ğŸ› ï¸ Setup Node
              uses: actions/setup-node@v6
              with:
                  node-version: lts/*

            - name: ğŸ Install pnpm
              uses: pnpm/action-setup@v4
              with:
                  version: 10
                  run_install: false

            - name: ğŸšï¸ pnpm install
              working-directory: webapp
              run: pnpm install

            - name: ğŸªš pnpm run build
              working-directory: webapp
              run: pnpm run build:deno

            - name: Deploy to Deno Deploy
              uses: denoland/deployctl@v1
              with:
                  project: "place-view"
                  entrypoint: "server/index.js"
                  root: "webapp/.deno-deploy"
